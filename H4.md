# Omat komennot

Tehtävänanto h4 Omat komennot: https://terokarvinen.com/2022/palvelinten-hallinta-2022p2/#h4-omat-komennot

## Harjoitusympäristö

Harjoitus on tehty omalla koneella kotonani 22.11.2022. Pääkoneena HP-kannettava, jossa Windows 11 Home käyttöjärjestelmä, 16GB RAM, 476GB levytilaa. 
Virtuaalikoneena Oracle VirtualBox 6.1.38, Linux Debian 11, 4GB RAM, 60GB levytilaa.

## Hei Maailma

Aloitin ensin tekemällä edellisellä oppitunneilla tekemääni scripts-hakemistoon tiedoston hello.sh,johon kirjoitin "hei maailma". Testasin komennon ajamalle sen
bashilla, jolloin näytölle tulostui "hei maailma".

![image](https://user-images.githubusercontent.com/113497086/203262592-23b79c5f-5438-4ddb-9982-33330be6323d.png)

Seuraavaksi halusin että komennon voisi ajaa ilman bashia paikallisesti tässä sijainnissa (piste komennon alussa tarkoittaa nykyistä hakemistoa). Ensin kokeilin 
lopputulosta, jolla komennon haluaisin toimivan, mutta sehän ei tietenkään vielä toimi. Lisäsin hei.sh-tiedostoon ylimmän rivin (#!/usr/bin/bash) eli tiedon millä
sisältö ajetaan. Kokeilin komentoa uudestaan, mutta vieläkään se ei toimi, koska käyttöoikeudet eivät ole oikein. Listaamalla oikeudet totesin että execute eli 
x puuttuu. Muokkasin oikeuksia lisäämällä chmodilla käyttöoikeidet kaikille, minkä jälkeen listasin oikeudet uudestaan, jotta näin niiden menneen kuten halusin 
ja samalla huomasin tiedostonimenkin vaihtuneen vihreäksi. Tämän jälkeen testasin `$ ./hei.sh`-komentoa ja nyt se toimi kuten halusin.

![image](https://user-images.githubusercontent.com/113497086/203263965-745864f5-001e-45e7-b3a5-7a4c5d9ad95b.png)

Komento täytyi saada toimimaan myös muilla ja nyt se oli vielä omassa kotihakemistossani. Kokeilin taas ensin lopputulosta eli että hei.sh tulostaisi "hei 
maailma". Kopioin scripts-hakemiston hei.sh käyttäjille sijaintiin "/usr/local/bin". Tämän jälkeen käsky toimi riippumatta siitä missä hakemistossa. Tarkistin
mistä komentoa ajetaan ja vastaus oli se minkä olin aiemmin asettanut, jonka jälkeen tarkistin vielä että oikeidet on oikein sielläkin. 

![image](https://user-images.githubusercontent.com/113497086/203269960-7e63860c-c976-445e-81ee-25e18cc89e38.png)

Seuraavaksi siirryin saltiin ja tein sinne uuden hakemiston `$ sudo mkdir heippa` ja sinne loin init.sls-tiedoston. Tein ensiksi testin saltissa tallentamalla init.sls-tiedostoon sudo-oikeuksin käskyn luoda tmp-hakemistoon tiedosto "sarisaltheippa". Tämän jälkeen ajoin tilan käyttämällä `$ sudo salt.call --local 
state.apply heippa` Sain ilmoituksen että tiedosto luotiin ja kävin sen vielä tarkistamassa että tiedosto tuli sinne mihin halusinkin. 

![image](https://user-images.githubusercontent.com/113497086/203278036-e62fa12a-df65-4ad5-b4ca-9d20c26e007d.png)

Seuraavaksi kopioin toimivaksi testaamani tiedoston tekemäänki heippa-hakemistoon: `$ sudo cp /usr/local/bin/hei.sh .`. Listaamalla hakemiston sisällön tarkistin että tiedosto kopioitui. Muokkasin tuon saman tiedostopolun init.sls-tiedoston ensimmäiselle riville testirivin tilalle. Koska tiedosto oli jo siellä
luotuna, sain hello-tilan ajamisen jälkeen ilmoituksen että muutoksia ei tehty. Succeeded kuitenkin kertoo että ajo onnistui. Tarkistin vielä kohteessa että tiedostosisältö pysyi ennallaan. 

![image](https://user-images.githubusercontent.com/113497086/203282619-ca58e016-f344-4a02-96dc-9fd28854c0e5.png)

Muokkasin init.sls-tiedostoon nyt lähteen josta hei.sh-tiedostosisältö haetaan eli lisäsin rivin `- source: salt://heippa/hei.sh`. Sain kuitenkin heippa-tilaa ajaessa virheilmoituksen: 

![image](https://user-images.githubusercontent.com/113497086/203285152-c9040bcb-ac44-46b1-97bb-f883025587ae.png)

Palasin tutkimaan init.sls-tiedostoa ja huomasin että file.managedin perästä puuttui kaksoispiste. Korjasin sen ja hello-tilaa uudestaan ajettaessa sain ilmoituksen että tiedosto on oikeassa tilassa ja muutoksia ei tehty. Päätin testata toimiiko tila oikeasti, joten poistin /usr/local/bin hakemistosta hei.sh
-tiedoston. Ajoin heippa-tilan taas ja nyt sain ilmoituksen että uusi tiedostosta ja mode eli käyttöoikeudet on 0644. Tarkistin tiedostosisällön ja se oli oikein sekä kokeilin hei.sh-komentoa mutta se ei toimi johtuen käyttöoikeuksista. 

![image](https://user-images.githubusercontent.com/113497086/203288755-9bf3a7b8-4171-45b8-848d-9a3a0e003b22.png)


Käyttöoikeudet täytyi lisätä init.sls numeroina ja koska tiedän tämän heippa-hakemiston hei.sh-tiedoston käyttöoikeuksien olevan oikein, tarkistan ne statilla ja kopioin virheiden minimoimiseksi. Access-kohdassa 0755 vastaa sen perässä olevaa kirjaimin esitettyä. Init.sls lisäsin sourcen perään rivin `- mode: '0755'`.
Tämän jälkeen ajoin tilan ja oikeudet muuttui 0755-mukaisesti. Tarkistin oikeuksien muuttumisen listaamalla ne komennolla `$ ls -l /usr/local/bin/hei.sh` ennen ja jälkeen. Tämän jälkeen hei.sh -komento toimi kaikissa hakemistoissa.

![image](https://user-images.githubusercontent.com/113497086/203289665-e2bd6d9c-8660-46a2-9d78-8777d327ef2e.png)

## Whatsup.sh

Edellisessä kohdassa tein testejä monessa kohdassa ja tämän kohdan tein vastaavasti niitä hyväksi käyttäen. Tein scripts-hakemistoon tiedoston whatsup.sh. Sinne kopioin edellisen tehtävän hei.sh sisällön. Muokkasin hieman tekstiosuutta ja lisäsin sinne date eli päivämäärän ja ajan. Muutin oikeudet chmodilla, tarkistin että ne muuttui oikein ja kopioin tiedoston kaikille. Testasin että komento toimii. 

![image](https://user-images.githubusercontent.com/113497086/203298592-a72012b7-be0e-4a1a-9577-e97ff09c0c19.png)

Siirryin saltiin ja loin sinne sudona hakemiston whatsup, jonne kopioin edellisessä tehtävässä luodun init.sls-tiedoston sisällön. Muokkasin polut niin että ne koski tätä uutta whatsup.sh-tiedostoa. Kopioin usr/local/bin -hakemistosta whatsup.sh -tiedoston saltin whatsup-hakemistoon. Ajoin whatsup-tilan ja ensimmäisessä ajossa localin eteen oli lipsahtanut välilyönti, jolloin virheilmoitus kertoi ettei ajo onnistunut. Korjasin virheen ja uuden ajon jälkeen sain ilmoituksen että se onnistui, mutta tiedosto oli jo oikeassa tilassa, joten muutoksia ei tehty. Poistin whatsup.sh-tiedoston usr/local/binistä, tarkistin että se poistui, jonka jälkeen ajoin tilan uudestaan. Se onnistui ja tiedosto lisättiin oikeilla oikeuksilla. Testasin vielä että komento toimii. 

![image](https://user-images.githubusercontent.com/113497086/203303133-b6acbeea-f69d-4214-9546-aa7fbe9acb5b.png)

## Hello.py

Tein scripts-hakemistooni tiedoston hello.py. Tätä lähdin rakentamaan niin että annetaan komennon yhteydessä argumentti, joka sijoitetaan sille annettuun kohtaan. Oppitunneilla tehtiin vastaava esimerkki ja katsoin syntaksin muistiinpanoistani. Testi osoitti että se onnistui.

![image](https://user-images.githubusercontent.com/113497086/203309184-a9c412ea-060c-4ab0-84f9-1730f730681e.png)

Tämän jälkeen lisäsin x-oikeudet kaikille, testasin että ne muuttuivat ja komento toimi. Kopioituani tiedoston kaikille, komento oli käytettävissä kaikkialla hakemistopolussa. 

![image](https://user-images.githubusercontent.com/113497086/203310327-ece782f8-a848-4907-ac8b-fbeb39193be6.png)

Nyt kun komento oli testattu siirryin saltiin ja loin sudona hakemiston hellosari, jonne kopioin hello.py-tiedoston ja tein init.sls-tiedoston mukaillen edellista tehtävää. Ajoin hellosari-tilan ja se onnistui, mutta muutoksia ei toki tullut koska tiedosto oli jo olemassa tällaisenaan. 

![image](https://user-images.githubusercontent.com/113497086/203312432-6334450a-83db-48a0-8f94-ef20c215bcae.png)

Poistin /usr/local/binistä hello.py-tiedoston, jonka jälkeen ajoin hellosari-tilan. Tiedoston lisääminen oikein käyttöoikeuksin onnistui ja komento toimii kuten sen kuuluukin. 

![image](https://user-images.githubusercontent.com/113497086/203313586-c5fe2451-379e-4b88-9bb5-5078f69ccb85.png)


## Skriptit kansiossa


